{% extends "base.html" %}
{% load static %}

{% block body %}
<style>
  :root{ --g-700:#00471b; --g-500:#7CC300; --line:#d9efbb; --bg:#f6faf3; --panel:#fff; --text:#0f172a; }
  body{ background:var(--bg); color:var(--text); font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial; }
  .wrap{ max-width:920px; margin:26px auto; padding:0 14px; }
  .card{ background:var(--panel); border:1px solid var(--g-500); border-radius:18px; box-shadow:0 14px 28px rgba(0,0,0,.08); overflow:hidden; }
  .card-hd{ display:flex; align-items:center; gap:12px; padding:18px 22px; background:linear-gradient(180deg,#8dd43a,#7CC300); color:#fff; }
  .card-hd i{ font-size:1.35rem; }
  .card-hd h2{ margin:0; font-size:1.5rem; letter-spacing:.2px; }
  .card-bd{ padding:22px; }
  .grid{ display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  @media (max-width:820px){ .grid{ grid-template-columns:1fr; } }
  .field{ position:relative; }
  .field label{ display:block; font-weight:700; color:#244; margin:4px 0 6px; }
  .icon-in{ position:absolute; left:12px; top:41px; transform:translateY(-50%); color:#2b7a2b; opacity:.9; pointer-events:none; }
  .input, .select{
    width:100%; height:46px; border-radius:12px; border:1.5px solid var(--line);
    padding:10px 12px 10px 40px; background:#fff; outline:0; transition:border-color .15s, box-shadow .15s;
  }
  .select{ padding-left:12px; } /* para selects de Django */
  .input:focus, .select:focus{ border-color:var(--g-500); box-shadow:0 0 0 3px rgba(124,195,0,.15); }
  .help{ font-size:.8rem; color:#64748b; margin-top:6px; }
  .actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:18px; }
  .btn{ display:inline-flex; align-items:center; gap:.55rem; padding:10px 14px; border-radius:12px; font-weight:700; border:1px solid var(--g-500);
        background:linear-gradient(180deg,#96da54, var(--g-500)); color:#fff; text-decoration:none; box-shadow:0 6px 14px rgba(124,195,0,.28);
        transition:transform .12s, box-shadow .12s; }
  .btn:hover{ transform:translateY(-1px); box-shadow:0 10px 18px rgba(124,195,0,.36); }
  .btn.out{ background:#fff; color:var(--g-700); border-color:var(--g-500); }
  .msg{ margin:-6px 0 14px; padding:10px 12px; border-radius:10px; border:1px solid #fed7aa; background:#fff7ed; color:#7c2d12; font-weight:600; }
  /* Normalizar input date para que se vea como los demás */
input[type="date"].input {
  padding-left: 40px;        /* igual que otros inputs */
  padding-right: 12px;
  line-height: 24px;
}

/* Ajustar posición del icono en inputs date */
.field input[type="date"] + .icon-in,
.field .icon-in {
  top: 41px;
}

/* Forzar alineación vertical consistente */
input[type="date"]::-webkit-datetime-edit {
  line-height: 24px;
}

/* Quitar estilos raros del calendario en Chrome */
input[type="date"]::-webkit-calendar-picker-indicator {
  opacity: 0.6;
  cursor: pointer;
}

</style>

<div class="wrap">
  <div class="card">
    <div class="card-hd">
      <i class="fa-solid fa-user-shield"></i>
      <h2>{{ title|default:"Usuario" }}</h2>
    </div>

    <div class="card-bd">

      <form method="post" autocomplete="off">
        {% csrf_token %}

        <div class="grid">
          <div class="field">
            <label for="id_cedula">Cédula</label>
            <i class="icon-in fa-solid fa-id-card"></i>
            {{ form.cedula }} <!-- si usás widgets desde forms.py este ya tendrá inputmode y pattern -->
            <small class="help">Solo dígitos.</small>
          </div>

          <div class="field">
            <label for="id_fecha_nacimiento">Fecha de nacimiento</label>
            <i class="icon-in fa-solid fa-cake-candles"></i>
            {{ form.fecha_nacimiento }}
            <!--<div class="help">Selecciona la fecha. (opcional)</div>-->
          </div>

          <div class="field">
            <label for="id_email">Email</label>
            <i class="icon-in fa-regular fa-envelope"></i>
            {{ form.email }}
          </div>

          <div class="field">
            <label for="id_nombre">Nombre</label>
            <i class="icon-in fa-regular fa-user"></i>
            {{ form.nombre }}
          </div>

          <div class="field">
            <label for="id_apellido">Apellido</label>
            <i class="icon-in fa-regular fa-user"></i>
            {{ form.apellido}}
          </div>

          <div class="field">
            <label for="id_role">Rol</label>
            {{ form.role }}
            <div class="help">Opciones: Administrador, Docente o Estudiante.</div>
          </div>

          <div class="field">
            <label for="id_is_active">Activo</label>
            {{ form.is_active }}
            <div class="help">Desmarcar bloquea el acceso.</div>
          </div>

          {% if mode == "create" %}
            <div class="field">
              <label for="password1">Contraseña</label>
              <i class="icon-in fa-solid fa-lock"></i>
              <input id="password1" name="password1" class="input" type="password" required>
              <div class="help">Mínimo 8 caracteres.</div>
            </div>

            <div class="field">
              <label for="password2">Repetir contraseña</label>
              <i class="icon-in fa-solid fa-lock"></i>
              <input id="password2" name="password2" class="input" type="password" required>
            </div>
          {% else %}
            <div class="field" style="grid-column:1/-1">
              <label for="password">Nueva contraseña <span class="help">(opcional)</span></label>
              <i class="icon-in fa-solid fa-key"></i>
              <input id="password" name="password" class="input" type="password" placeholder="Deja vacío para mantener la actual">
            </div>
          {% endif %}
        </div>

        <div class="actions">
          <a class="btn out" href="{% url 'evaluaciones_admin' %}">
            <i class="fa-solid fa-arrow-left-long"></i> Volver
          </a>
          <button class="btn" type="submit">
            <i class="fa-regular fa-floppy-disk"></i>
            {% if mode == "create" %}Crear{% else %}Guardar cambios{% endif %}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const cedInput = document.getElementById('cedula');
  if (cedInput){
    cedInput.addEventListener('input', function(e){
      // elimina cualquier caracter que no sea dígito
      this.value = this.value.replace(/\D+/g, '');
    });
  }

  const fecha = document.getElementById('fecha_nacimiento');
  if (fecha){
    // opcional: limitar fecha máxima a hoy - 5 años (ejemplo)
    const hoy = new Date();
    const anoMin = new Date(hoy.getFullYear()-5, hoy.getMonth(), hoy.getDate());
    fecha.max = hoy.toISOString().split('T')[0];
    // si querés forzar mínima edad:
    // fecha.max = anoMin.toISOString().split('T')[0];
  }
});
</script>

{% endblock %}
